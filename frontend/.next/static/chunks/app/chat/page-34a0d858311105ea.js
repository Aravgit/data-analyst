(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[457],{8686:(e,t,s)=>{Promise.resolve().then(s.bind(s,9717))},9717:(e,t,s)=>{"use strict";s.d(t,{default:()=>f});var a=s(5155),r=s(2115),l=s(6046);function n(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return t.filter(Boolean).join(" ")}let o={default:"bg-indigo-500 text-white hover:bg-indigo-400",ghost:"bg-transparent text-slate-700 hover:bg-slate-100",outline:"border border-slate-300 text-slate-900 hover:bg-slate-100",destructive:"bg-rose-600 text-white hover:bg-rose-500"},i={sm:"h-9 px-3",md:"h-10 px-4",lg:"h-11 px-5"},d=r.forwardRef(function(e,t){let{className:s,variant:r="default",size:l="md",...d}=e;return(0,a.jsx)("button",{ref:t,className:n("inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-indigo-500 disabled:opacity-50 disabled:pointer-events-none",o[r],i[l],s),...d})}),c=r.forwardRef(function(e,t){let{className:s,...r}=e;return(0,a.jsx)("input",{ref:t,className:n("flex h-10 w-full rounded-md border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm transition focus:border-indigo-400 focus:outline-none",s),...r})});function x(e){let{className:t,...s}=e;return(0,a.jsx)("div",{className:n("rounded-2xl border border-slate-200 bg-white shadow-lg",t),...s})}var m=s(8403),u=s(6246);function h(e){try{return JSON.parse(e)}catch(e){}try{let t=function(e){let t=e.replace(/-/g,"+").replace(/_/g,"/"),s=t.length%4?4-t.length%4:0;return atob(t+"=".repeat(s))}(e);return JSON.parse(t)}catch(e){}return e}function p(e){var t;let{frame:s,download:l}=e,n=Array.isArray(s.rows)?s.rows:[],[o,i]=(0,r.useState)(0),d=(0,r.useMemo)(()=>Math.max(1,Math.ceil(n.length/10)),[n]),c=(0,r.useMemo)(()=>{let e=10*o;return n.slice(e,e+10)},[n,o]),x=null!==(t=s.row_count)&&void 0!==t?t:n.length;return(0,a.jsxs)("div",{className:"space-y-3 rounded-xl border border-slate-200 bg-slate-50 p-3",children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.2em] text-slate-500",children:"Data"}),(0,a.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:s.logical_name||s.df_name}),(0,a.jsxs)("p",{className:"text-xs text-slate-600",children:["Showing ",c.length," of ",n.length," buffered rows \xb7 ",s.columns.length," cols \xb7 ",x," total rows"]})]}),l&&(0,a.jsxs)("div",{className:"text-xs text-slate-700",children:["Download: ",(0,a.jsx)("code",{className:"text-[11px] bg-white px-1 rounded",children:l.path})]})]}),(0,a.jsx)("div",{className:"overflow-x-auto rounded-lg border border-slate-200 bg-white",children:(0,a.jsxs)("table",{className:"min-w-full text-xs text-slate-900",children:[(0,a.jsx)("thead",{className:"bg-slate-100",children:(0,a.jsx)("tr",{children:s.columns.map(e=>(0,a.jsx)("th",{className:"px-2 py-2 text-left font-semibold border-b border-slate-200",children:e},e))})}),(0,a.jsx)("tbody",{children:c.map((e,t)=>(0,a.jsx)("tr",{className:"odd:bg-white even:bg-slate-50",children:s.columns.map(t=>{var s;return(0,a.jsx)("td",{className:"px-2 py-1 border-b border-slate-100",children:String(null!==(s=null==e?void 0:e[t])&&void 0!==s?s:"")},t)})},t))})]})}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs text-slate-700",children:[(0,a.jsxs)("div",{children:["Page ",o+1," / ",d]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{className:"rounded border border-slate-300 bg-white px-2 py-1 disabled:opacity-50",onClick:()=>i(e=>Math.max(0,e-1)),disabled:0===o,children:"Prev"}),(0,a.jsx)("button",{className:"rounded border border-slate-300 bg-white px-2 py-1 disabled:opacity-50",onClick:()=>i(e=>Math.min(d-1,e+1)),disabled:o>=d-1,children:"Next"})]})]})]})}let b=s(2818).env.NEXT_PUBLIC_API_BASE||"http://localhost:8000";function f(){let e=(0,l.useSearchParams)(),t=(0,l.useRouter)(),[s,o]=(0,r.useState)(""),[i,f]=(0,r.useState)([{role:"assistant",content:"Upload a CSV to begin, then ask me anything about it."}]),[g,v]=(0,r.useState)(!0),[j,N]=(0,r.useState)([]),[w,y]=(0,r.useState)({input:0,output:0,total:0}),[k,S]=(0,r.useState)(null),[_,C]=(0,r.useState)(""),[A,M]=(0,r.useState)(""),[P,R]=(0,r.useState)(!1),[T,D]=(0,r.useState)(!1),[E,O]=(0,r.useState)(null),[U,V]=(0,r.useState)(""),[B,L]=(0,r.useState)([]),[I,J]=(0,r.useState)([]),[F,q]=(0,r.useState)("summary");(0,r.useEffect)(()=>{let t=e.get("session"),a=e.get("csv");t&&!s&&(o(t),V(a||""),f([{role:"assistant",content:"Ready. CSV loaded as '".concat(a||"your file","'.")}]))},[e,s]);let z=(0,r.useMemo)(()=>!!s,[s]),W=e=>f(t=>[...t,e]),H=(e,t)=>N(s=>[{kind:e,detail:t},...s].slice(0,50));async function X(){if(!k&&!_.trim()){W({role:"error",content:"Choose a CSV file or enter a path."});return}D(!0);try{let e=new FormData;k&&e.append("file",k),_.trim()&&e.append("path",_.trim()),s&&e.append("session_id",s);let a=await fetch("".concat(b,"/upload"),{method:"POST",body:e});if(!a.ok)throw Error(await a.text());let r=await a.json();o(r.session_id),V(r.csv_name),W({role:"status",content:"Ready. CSV loaded as '".concat(r.csv_name,"'.")}),H("upload","Loaded ".concat(r.csv_name)),r.session_reset&&(f([{role:"assistant",content:"Upload a CSV to begin, then ask me anything about it."}]),N([]),M(""));let l=new URLSearchParams({session:r.session_id,csv:r.csv_name}).toString();t.replace("/chat?".concat(l))}catch(e){W({role:"error",content:(null==e?void 0:e.message)||"Upload failed."})}finally{D(!1)}}async function Y(e){if(e.preventDefault(),!A.trim())return;if(!z){W({role:"error",content:"Upload a CSV first."});return}let t=A.trim();M(""),W({role:"user",content:t}),R(!0),H("status","Model call started"),await G(t)}async function G(e){try{let t=await fetch("".concat(b,"/chat/stream"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e,session_id:s})});if(!t.ok||!t.body)throw Error(await t.text());let a=t.body.getReader(),r=new TextDecoder,l="",n=i.length;for(W({role:"assistant",content:""}),O({idx:n,text:""});;){let{value:e,done:t}=await a.read();if(t)break;let s=(l+=r.decode(e,{stream:!0})).split("\n\n");for(let e of(l=s.pop()||"",s))await K(e)}l.trim().length&&await K(l)}catch(e){W({role:"error",content:(null==e?void 0:e.message)||"Agent error."}),H("error",(null==e?void 0:e.message)||"Agent error.")}finally{R(!1),O(null)}}async function K(e){var t,s,a;let r=e.split("\n"),l="message",n="";for(let e of r)e.startsWith("event:")?l=e.replace("event:","").trim():e.startsWith("data:")&&(n+=e.replace("data:","").trim());let o=n;try{o=JSON.parse(n)}catch(e){}if("partial"===l){if(E){let e=(E.text+" "+(o.text||o)).trim();O({...E,text:e}),f(t=>t.map((t,s)=>s===E.idx?{...t,content:e}:t))}return}if("reply"===l){let e=o.text||"",t=o.status||"ok";E?f(t=>t.map((t,s)=>s===E.idx?{...t,content:e}:t)):W({role:"assistant",content:e}),"token_limit"===t&&W({role:"status",content:"Token budget reached (50k). Continuing with compacted history."}),H("reply","Reply received");return}if("status"===l){H("status","Stage: ".concat(o.stage||o));return}if("tool_call"===l){H("tool","Calling ".concat(o.name||""));return}if("tool_result"===l){H("tool","Tool result (".concat(o.result_kind||"ok",")"));return}if("token_usage"===l){let e=Number(o.input_tokens||0),t=Number(o.output_tokens||0),s=Number(o.total_tokens||0);y({input:e,output:t,total:s}),H("tokens","In ".concat(e,", out ").concat(t,", total ").concat(s));return}if("error"===l){W({role:"error",content:o.message||"Agent error."}),H("error",o.message||"Agent error.");return}if("data_frame"===l){try{let e=null!==(s=null==o?void 0:o.payload)&&void 0!==s?s:o,a="string"==typeof e?h(e):e;if(!a||!Array.isArray(a.columns)||!Array.isArray(a.rows)){H("error","Bad data_frame payload");return}L(e=>{let t=e.filter(e=>e.df_name!==a.df_name);return[a,...t].slice(0,5)}),H("data","Table ".concat(a.df_name||"df"," (").concat(a.row_count||(null===(t=a.rows)||void 0===t?void 0:t.length)||0," rows)"))}catch(e){H("error","Failed to decrypt table")}return}if("data_download"===l){try{let e=null!==(a=null==o?void 0:o.payload)&&void 0!==a?a:o,t="string"==typeof e?h(e):e;J(e=>{let s=e.filter(e=>e.path!==t.path);return[t,...s].slice(0,10)}),H("data","Download ready: ".concat(t.logical_name||t.df_name||"table"))}catch(e){H("error","Failed to decrypt download info")}return}}let Q=e=>n("max-w-3xl rounded-lg px-4 py-3 text-sm border whitespace-pre-wrap break-words overflow-x-auto","user"===e?"bg-white text-slate-900 border-slate-200 ml-auto text-right":"","assistant"===e?"bg-slate-100 text-slate-900 border-slate-200 mr-auto":"","status"===e?"bg-slate-50 text-slate-600 border-slate-200 mr-auto":"","error"===e?"bg-rose-50 text-rose-800 border-rose-200 mr-auto":""),Z=e=>{switch(e){case"user":return"You";case"assistant":return"Agent";case"status":return"Status";case"error":return"Error"}};return(0,a.jsx)("div",{className:"mx-auto flex min-h-screen w-full max-w-screen-2xl flex-col gap-6 px-4 py-8",children:(0,a.jsxs)("div",{className:"grid gap-4 lg:grid-cols-[1.1fr,3.2fr,1fr]",children:[(0,a.jsxs)(x,{className:"p-4",children:[(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.2em] text-slate-500",children:"Data"}),(0,a.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:"Current file"}),(0,a.jsx)("p",{className:"text-sm text-slate-600",children:U||"None loaded"})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("input",{type:"file",accept:".csv",onChange:e=>{var t;return S((null===(t=e.target.files)||void 0===t?void 0:t[0])||null)},className:"block w-full text-sm text-slate-700 file:mr-4 file:rounded-md file:border file:border-slate-300 file:bg-white file:px-3 file:py-2 file:text-slate-800 hover:file:bg-slate-50"}),(0,a.jsx)(c,{value:_,onChange:e=>C(e.target.value),placeholder:"Path on server (e.g. /data/sales.csv)",className:"bg-white text-slate-900 border-slate-300"}),(0,a.jsx)(d,{onClick:X,disabled:T,className:"w-full",children:T?"Uploading...":s?"Replace data":"Load data"}),(0,a.jsxs)("div",{className:"rounded-lg border border-slate-200 bg-white p-3 text-xs text-slate-600",children:[(0,a.jsx)("p",{className:"font-semibold text-slate-900",children:"Tips"}),(0,a.jsxs)("ul",{className:"mt-1 space-y-1",children:[(0,a.jsx)("li",{children:"- Max CSV size 400 MB."}),(0,a.jsx)("li",{children:"- Session stays via URL params."}),(0,a.jsx)("li",{children:"- Ask for samples, summaries, plots."})]})]})]})]}),(0,a.jsxs)(x,{className:"p-5",children:[(0,a.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.2em] text-slate-500",children:"Conversation"}),(0,a.jsx)("h1",{className:"text-2xl font-semibold text-slate-900",children:"Chat with your data"})]}),P?(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs text-emerald-600",children:[(0,a.jsx)("span",{className:"h-2 w-2 animate-ping rounded-full bg-emerald-500"}),"Thinking"]}):(0,a.jsx)("div",{className:"text-xs text-slate-500",children:"Ready"})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"grid w-full grid-cols-2 rounded-md border border-slate-200 bg-slate-50",children:[(0,a.jsx)("button",{onClick:()=>q("summary"),className:n("py-2 text-sm font-semibold","summary"===F?"bg-white text-slate-900 shadow-inner":"text-slate-600"),children:"Summary"}),(0,a.jsx)("button",{onClick:()=>q("data"),className:n("py-2 text-sm font-semibold","data"===F?"bg-white text-slate-900 shadow-inner":"text-slate-600"),children:"Data"})]}),"summary"===F&&(0,a.jsxs)("div",{className:"min-h-[620px] max-h-[860px] space-y-3 overflow-y-auto rounded-xl border border-slate-200 bg-white p-4 shadow-inner",children:[i.map((e,t)=>(0,a.jsxs)("div",{className:n(Q(e.role),"user"===e.role?"text-right":"text-left"),children:[(0,a.jsx)("div",{className:"mb-1 text-[11px] uppercase tracking-wide text-slate-500",children:Z(e.role)}),(0,a.jsx)("div",{className:"prose prose-sm prose-slate max-w-none text-slate-900",children:(0,a.jsx)(m.o,{remarkPlugins:[u.A],children:e.content})})]},t)),0===i.length&&(0,a.jsx)("div",{className:"text-sm text-slate-500",children:"No messages yet - upload and ask a question."})]}),"data"===F&&(0===B.length?(0,a.jsx)("div",{className:"rounded-xl border border-slate-200 bg-white p-4 text-sm text-slate-600",children:"No data yet."}):(0,a.jsx)(p,{frame:B[0],download:I[0]}))]}),(0,a.jsxs)("form",{onSubmit:Y,className:"flex gap-2",children:[(0,a.jsx)(c,{className:"flex-1 bg-white border-slate-300",placeholder:"Ask a question about your data...",value:A,onChange:e=>M(e.target.value),disabled:P}),(0,a.jsx)(d,{type:"submit",disabled:P,children:"Send"})]})]})]}),(0,a.jsxs)(x,{className:"p-4",children:[(0,a.jsxs)("div",{className:"mb-2 flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.2em] text-slate-500",children:"Activity"}),(0,a.jsx)("h3",{className:"text-sm font-semibold text-slate-900",children:"Model & tools"})]}),(0,a.jsx)(d,{variant:"ghost",size:"sm",onClick:()=>v(e=>!e),children:g?"Hide":"Show"})]}),(0,a.jsxs)("div",{className:"mb-3 grid grid-cols-3 gap-2 text-xs text-slate-700",children:[(0,a.jsxs)("div",{className:"rounded-md border border-slate-200 bg-white p-2",children:[(0,a.jsx)("p",{className:"text-[10px] uppercase tracking-wide text-slate-500",children:"Input"}),(0,a.jsx)("p",{className:"font-semibold text-slate-900",children:w.input})]}),(0,a.jsxs)("div",{className:"rounded-md border border-slate-200 bg-white p-2",children:[(0,a.jsx)("p",{className:"text-[10px] uppercase tracking-wide text-slate-500",children:"Output"}),(0,a.jsx)("p",{className:"font-semibold text-slate-900",children:w.output})]}),(0,a.jsxs)("div",{className:"rounded-md border border-slate-200 bg-white p-2",children:[(0,a.jsx)("p",{className:"text-[10px] uppercase tracking-wide text-slate-500",children:"Total"}),(0,a.jsx)("p",{className:"font-semibold text-slate-900",children:w.total})]})]}),g&&(0,a.jsxs)("div",{className:"space-y-2 max-h-[520px] overflow-y-auto text-sm text-slate-800",children:[0===j.length&&(0,a.jsx)("div",{className:"text-slate-500 text-xs",children:"No activity yet."}),j.map((e,t)=>(0,a.jsxs)("div",{className:"rounded-md border border-slate-200 bg-white px-2 py-1",children:[(0,a.jsx)("span",{className:"text-xs uppercase text-slate-500 mr-2",children:e.kind}),(0,a.jsx)("span",{children:e.detail})]},t)),I.length>0&&(0,a.jsxs)("div",{className:"rounded-md border border-slate-200 bg-white px-2 py-2",children:[(0,a.jsx)("div",{className:"text-[10px] uppercase tracking-wide text-slate-500 mb-1",children:"Downloads"}),(0,a.jsx)("div",{className:"space-y-1",children:I.map((e,t)=>(0,a.jsxs)("div",{className:"text-xs",children:[(0,a.jsx)("span",{className:"font-semibold",children:e.logical_name||e.df_name||"table"}),":"," ",(0,a.jsx)("code",{className:"bg-slate-50 px-1 rounded",children:e.path})]},t))})]})]})]})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[703,441,517,358],()=>t(8686)),_N_E=e.O()}]);